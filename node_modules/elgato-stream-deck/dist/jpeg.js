"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.encodeJPEG = void 0;
const jpegJS = require("jpeg-js");
let jpegTurbo;
try {
    // tslint:disable-next-line: no-var-requires
    jpegTurbo = require('@julusian/jpeg-turbo');
}
catch (e) {
    // This is expected and can be ignored
}
const DEFAULT_QUALITY = 95;
function encodeJPEG(buffer, width, height, options) {
    try {
        // Try using jpeg-turbo if it is available
        if (jpegTurbo && jpegTurbo.bufferSize && jpegTurbo.compressSync) {
            const encodeOptions = {
                format: jpegTurbo.FORMAT_RGBA,
                width,
                height,
                quality: DEFAULT_QUALITY,
                ...options,
            };
            if (buffer.length === width * height * 4) {
                const tmpBuffer = Buffer.alloc(jpegTurbo.bufferSize(encodeOptions));
                return jpegTurbo.compressSync(buffer, tmpBuffer, encodeOptions);
            }
        }
    }
    catch (e) {
        // TODO - log error
        jpegTurbo = undefined;
    }
    // If jpeg-turbo is unavailable or fails, then fallback to jpeg-js
    const jpegBuffer2 = jpegJS.encode({
        width,
        height,
        data: buffer,
    }, options ? options.quality : DEFAULT_QUALITY);
    return jpegBuffer2.data;
}
exports.encodeJPEG = encodeJPEG;
//# sourceMappingURL=jpeg.js.map